{"ast":null,"code":"import { createContext, useReducer, useEffect } from 'react';\nimport reducers from './Reducers';\nimport { getData } from '../utils/fetchData';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport var DataContext = /*#__PURE__*/createContext();\nexport var DataProvider = function DataProvider(_ref) {\n  var children = _ref.children;\n  var initialState = {\n    notify: {},\n    auth: {},\n    cart: [],\n    modal: [],\n    orders: [],\n    users: [],\n    categories: []\n  };\n  var _useReducer = useReducer(reducers, initialState),\n    state = _useReducer[0],\n    dispatch = _useReducer[1];\n  var cart = state.cart,\n    auth = state.auth;\n  useEffect(function () {\n    var firstLogin = localStorage.getItem(\"firstLogin\");\n    if (firstLogin) {\n      getData('auth/accessToken').then(function (res) {\n        if (res.err) return localStorage.removeItem(\"firstLogin\");\n        dispatch({\n          type: \"AUTH\",\n          payload: {\n            token: res.access_token,\n            user: res.user\n          }\n        });\n      });\n    }\n    getData('categories').then(function (res) {\n      if (res.err) return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: res.err\n        }\n      });\n      dispatch({\n        type: \"ADD_CATEGORIES\",\n        payload: res.categories\n      });\n    });\n  }, []);\n  useEffect(function () {\n    var __next__cart01__sanj = JSON.parse(localStorage.getItem('__next__cart01__sanj'));\n    if (__next__cart01__sanj) dispatch({\n      type: 'ADD_CART',\n      payload: __next__cart01__sanj\n    });\n  }, []);\n  useEffect(function () {\n    localStorage.setItem('__next__cart01__sanj', JSON.stringify(cart));\n  }, [cart]);\n  useEffect(function () {\n    if (auth.token) {\n      getData('order', auth.token).then(function (res) {\n        if (res.err) return dispatch({\n          type: 'NOTIFY',\n          payload: {\n            error: res.err\n          }\n        });\n        dispatch({\n          type: 'ADD_ORDERS',\n          payload: res.orders\n        });\n      });\n      if (auth.user.role === 'admin') {\n        getData('user', auth.token).then(function (res) {\n          if (res.err) return dispatch({\n            type: 'NOTIFY',\n            payload: {\n              error: res.err\n            }\n          });\n          dispatch({\n            type: 'ADD_USERS',\n            payload: res.users\n          });\n        });\n      }\n    } else {\n      dispatch({\n        type: 'ADD_ORDERS',\n        payload: []\n      });\n      dispatch({\n        type: 'ADD_USERS',\n        payload: []\n      });\n    }\n  }, [auth.token]);\n  return /*#__PURE__*/_jsx(DataContext.Provider, {\n    value: {\n      state: state,\n      dispatch: dispatch\n    },\n    children: children\n  });\n};","map":null,"metadata":{},"sourceType":"module"}