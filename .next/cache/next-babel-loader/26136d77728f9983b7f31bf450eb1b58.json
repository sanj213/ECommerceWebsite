{"ast":null,"code":"import connectDB from '../../../utils/connectDB';\nimport Users from '../../../models/userModel';\nimport bcrypt from 'bcrypt';\nimport { createAccessToken, createRefreshToken } from '../../../utils/generateToken';\nconnectDB();\nexport default async (req, res) => {\n  switch (req.method) {\n    case \"POST\":\n      await login(req, res);\n      break;\n  }\n};\nconst login = async (req, res) => {\n  try {\n    const {\n      email,\n      password\n    } = req.body;\n    const user = await Users.findOne({\n      email\n    });\n    if (!user) return res.status(400).json({\n      err: 'This user does not exist.'\n    });\n    const isMatch = await bcrypt.compare(password, user.password);\n    if (!isMatch) return res.status(400).json({\n      err: 'Incorrect password.'\n    });\n    const access_token = createAccessToken({\n      id: user._id\n    });\n    const refresh_token = createRefreshToken({\n      id: user._id\n    });\n    res.json({\n      msg: \"Login Success!\",\n      refresh_token,\n      access_token,\n      user: {\n        name: user.name,\n        email: user.email,\n        role: user.role,\n        avatar: user.avatar,\n        root: user.root\n      }\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};","map":null,"metadata":{},"sourceType":"module"}