{"ast":null,"code":"function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nimport Head from 'next/head';\nimport { useState, useContext, useEffect } from 'react';\nimport { DataContext } from '../store/GlobalState';\nimport Link from 'next/link';\nimport valid from '../utils/valid';\nimport { patchData } from '../utils/fetchData';\nimport { imageUpload } from '../utils/imageUpload';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nconst Profile = () => {\n  const initialSate = {\n    avatar: '',\n    name: '',\n    password: '',\n    cf_password: ''\n  };\n  const {\n    0: data,\n    1: setData\n  } = useState(initialSate);\n  const {\n    avatar,\n    name,\n    password,\n    cf_password\n  } = data;\n  const {\n    state,\n    dispatch\n  } = useContext(DataContext);\n  const {\n    auth,\n    notify,\n    orders\n  } = state;\n  useEffect(() => {\n    if (auth.user) setData(_objectSpread(_objectSpread({}, data), {}, {\n      name: auth.user.name\n    }));\n  }, [auth.user]);\n  const handleChange = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setData(_objectSpread(_objectSpread({}, data), {}, {\n      [name]: value\n    }));\n    dispatch({\n      type: 'NOTIFY',\n      payload: {}\n    });\n  };\n  const handleUpdateProfile = e => {\n    e.preventDefault();\n    if (password) {\n      const errMsg = valid(name, auth.user.email, password, cf_password);\n      if (errMsg) return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: errMsg\n        }\n      });\n      updatePassword();\n    }\n    if (name !== auth.user.name || avatar) updateInfor();\n  };\n  const updatePassword = () => {\n    dispatch({\n      type: 'NOTIFY',\n      payload: {\n        loading: true\n      }\n    });\n    patchData('user/resetPassword', {\n      password\n    }, auth.token).then(res => {\n      if (res.err) return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: res.err\n        }\n      });\n      return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          success: res.msg\n        }\n      });\n    });\n  };\n  const changeAvatar = e => {\n    const file = e.target.files[0];\n    if (!file) return dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: 'File does not exist.'\n      }\n    });\n    if (file.size > 1024 * 1024)\n      //1mb\n      return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: 'The largest image size is 1mb.'\n        }\n      });\n    if (file.type !== \"image/jpeg\" && file.type !== \"image/png\")\n      //1mb\n      return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: 'Image format is incorrect.'\n        }\n      });\n    setData(_objectSpread(_objectSpread({}, data), {}, {\n      avatar: file\n    }));\n  };\n  const updateInfor = async () => {\n    let media;\n    dispatch({\n      type: 'NOTIFY',\n      payload: {\n        loading: true\n      }\n    });\n    if (avatar) media = await imageUpload([avatar]);\n    patchData('user', {\n      name,\n      avatar: avatar ? media[0].url : auth.user.avatar\n    }, auth.token).then(res => {\n      if (res.err) return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: res.err\n        }\n      });\n      dispatch({\n        type: 'AUTH',\n        payload: {\n          token: auth.token,\n          user: res.user\n        }\n      });\n      return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          success: res.msg\n        }\n      });\n    });\n  };\n  if (!auth.user) return null;\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"profile_page\",\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: \"Profile\"\n      })\n    }), /*#__PURE__*/_jsxs(\"section\", {\n      className: \"row text-secondary my-3\",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-md-4\",\n        children: [/*#__PURE__*/_jsx(\"h3\", {\n          className: \"text-center text-uppercase\",\n          children: auth.user.role === 'user' ? 'User Profile' : 'Admin Profile'\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"avatar\",\n          children: [/*#__PURE__*/_jsx(\"img\", {\n            src: avatar ? URL.createObjectURL(avatar) : auth.user.avatar,\n            alt: \"avatar\"\n          }), /*#__PURE__*/_jsxs(\"span\", {\n            children: [/*#__PURE__*/_jsx(\"i\", {\n              className: \"fas fa-camera\"\n            }), /*#__PURE__*/_jsx(\"p\", {\n              children: \"Change\"\n            }), /*#__PURE__*/_jsx(\"input\", {\n              type: \"file\",\n              name: \"file\",\n              id: \"file_up\",\n              accept: \"image/*\",\n              onChange: changeAvatar\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsx(\"label\", {\n            htmlFor: \"name\",\n            children: \"Name\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            type: \"text\",\n            name: \"name\",\n            value: name,\n            className: \"form-control\",\n            placeholder: \"Your name\",\n            onChange: handleChange\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsx(\"label\", {\n            htmlFor: \"email\",\n            children: \"Email\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            type: \"text\",\n            name: \"email\",\n            defaultValue: auth.user.email,\n            className: \"form-control\",\n            disabled: true\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsx(\"label\", {\n            htmlFor: \"password\",\n            children: \"New Password\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            type: \"password\",\n            name: \"password\",\n            value: password,\n            className: \"form-control\",\n            placeholder: \"Your new password\",\n            onChange: handleChange\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsx(\"label\", {\n            htmlFor: \"cf_password\",\n            children: \"Confirm New Password\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            type: \"password\",\n            name: \"cf_password\",\n            value: cf_password,\n            className: \"form-control\",\n            placeholder: \"Confirm new password\",\n            onChange: handleChange\n          })]\n        }), /*#__PURE__*/_jsx(\"button\", {\n          className: \"btn btn-info\",\n          disabled: notify.loading,\n          onClick: handleUpdateProfile,\n          children: \"Update\"\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-md-8\",\n        children: [/*#__PURE__*/_jsx(\"h3\", {\n          className: \"text-uppercase\",\n          children: \"Orders\"\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"my-3 table-responsive\",\n          children: /*#__PURE__*/_jsxs(\"table\", {\n            className: \"table-bordered table-hover w-100 text-uppercase\",\n            style: {\n              minWidth: '600px',\n              cursor: 'pointer'\n            },\n            children: [/*#__PURE__*/_jsx(\"thead\", {\n              className: \"bg-light font-weight-bold\",\n              children: /*#__PURE__*/_jsxs(\"tr\", {\n                children: [/*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"id\"\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"date\"\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"total\"\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"delivered\"\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"paid\"\n                })]\n              })\n            }), /*#__PURE__*/_jsx(\"tbody\", {\n              children: orders.map(order => /*#__PURE__*/_jsxs(\"tr\", {\n                children: [/*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: /*#__PURE__*/_jsx(Link, {\n                    href: `/order/${order._id}`,\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      children: order._id\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: new Date(order.createdAt).toLocaleDateString()\n                }), /*#__PURE__*/_jsxs(\"td\", {\n                  className: \"p-2\",\n                  children: [\"$\", order.total]\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: order.delivered ? /*#__PURE__*/_jsx(\"i\", {\n                    className: \"fas fa-check text-success\"\n                  }) : /*#__PURE__*/_jsx(\"i\", {\n                    className: \"fas fa-times text-danger\"\n                  })\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: order.paid ? /*#__PURE__*/_jsx(\"i\", {\n                    className: \"fas fa-check text-success\"\n                  }) : /*#__PURE__*/_jsx(\"i\", {\n                    className: \"fas fa-times text-danger\"\n                  })\n                })]\n              }, order._id))\n            })]\n          })\n        })]\n      })]\n    })]\n  });\n};\nexport default Profile;","map":null,"metadata":{},"sourceType":"module"}