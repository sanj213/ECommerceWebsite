{"ast":null,"code":"function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nimport connectDB from '../../../utils/connectDB';\nimport Products from '../../../models/productModel';\nimport auth from '../../../middleware/auth';\nconnectDB();\nexport default async (req, res) => {\n  switch (req.method) {\n    case \"GET\":\n      await getProducts(req, res);\n      break;\n    case \"POST\":\n      await createProduct(req, res);\n      break;\n  }\n};\nclass APIfeatures {\n  constructor(query, queryString) {\n    this.query = query;\n    this.queryString = queryString;\n  }\n  filtering() {\n    const queryObj = _objectSpread({}, this.queryString);\n    const excludeFields = ['page', 'sort', 'limit'];\n    excludeFields.forEach(el => delete queryObj[el]);\n    if (queryObj.category !== 'all') this.query.find({\n      category: queryObj.category\n    });\n    if (queryObj.title !== 'all') this.query.find({\n      title: {\n        $regex: queryObj.title\n      }\n    });\n    this.query.find();\n    return this;\n  }\n  sorting() {\n    if (this.queryString.sort) {\n      const sortBy = this.queryString.sort.split(',').join('');\n      this.query = this.query.sort(sortBy);\n    } else {\n      this.query = this.query.sort('-createdAt');\n    }\n    return this;\n  }\n  paginating() {\n    const page = this.queryString.page * 1 || 1;\n    const limit = this.queryString.limit * 1 || 6;\n    const skip = (page - 1) * limit;\n    this.query = this.query.skip(skip).limit(limit);\n    return this;\n  }\n}\nconst getProducts = async (req, res) => {\n  try {\n    const features = new APIfeatures(Products.find(), req.query).filtering().sorting().paginating();\n    const products = await features.query;\n    res.json({\n      status: 'success',\n      result: products.length,\n      products\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};\nconst createProduct = async (req, res) => {\n  try {\n    const result = await auth(req, res);\n    if (result.role !== 'admin') return res.status(400).json({\n      err: 'Authentication is not valid.'\n    });\n    const {\n      title,\n      price,\n      inStock,\n      description,\n      content,\n      category,\n      images\n    } = req.body;\n    if (!title || !price || !inStock || !description || !content || category === 'all' || images.length === 0) return res.status(400).json({\n      err: 'Please add all the fields.'\n    });\n    const newProduct = new Products({\n      title: title.toLowerCase(),\n      price,\n      inStock,\n      description,\n      content,\n      category,\n      images\n    });\n    await newProduct.save();\n    res.json({\n      msg: 'Success! Created a new product'\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};","map":{"version":3,"names":["connectDB","Products","auth","req","res","method","getProducts","createProduct","APIfeatures","constructor","query","queryString","filtering","queryObj","_objectSpread","excludeFields","forEach","el","category","find","title","$regex","sorting","sort","sortBy","split","join","paginating","page","limit","skip","features","products","json","status","result","length","err","message","role","price","inStock","description","content","images","body","newProduct","toLowerCase","save","msg"],"sources":["/Users/sanjanaa/Documents/UrbanBasket/pages/api/product/index.js"],"sourcesContent":["import connectDB from '../../../utils/connectDB'\nimport Products from '../../../models/productModel'\nimport auth from '../../../middleware/auth'\n\nconnectDB()\n\nexport default async (req, res) => {\n    switch(req.method){\n        case \"GET\":\n            await getProducts(req, res)\n            break;\n        case \"POST\":\n            await createProduct(req, res)\n            break;\n    }\n}\n\nclass APIfeatures {\n    constructor(query, queryString){\n        this.query = query;\n        this.queryString = queryString;\n    }\n    filtering(){\n        const queryObj = {...this.queryString}\n\n        const excludeFields = ['page', 'sort', 'limit']\n        excludeFields.forEach(el => delete(queryObj[el]))\n\n        if(queryObj.category !== 'all')\n            this.query.find({category: queryObj.category})\n        if(queryObj.title !== 'all')\n            this.query.find({title: {$regex: queryObj.title}})\n\n        this.query.find()\n        return this;\n    }\n\n    sorting(){\n        if(this.queryString.sort){\n            const sortBy = this.queryString.sort.split(',').join('')\n            this.query = this.query.sort(sortBy)\n        }else{\n            this.query = this.query.sort('-createdAt')\n        }\n\n        return this;\n    }\n\n    paginating(){\n        const page = this.queryString.page * 1 || 1\n        const limit = this.queryString.limit * 1 || 6\n        const skip = (page - 1) * limit;\n        this.query = this.query.skip(skip).limit(limit)\n        return this;\n    }\n}\n\nconst getProducts = async (req, res) => {\n    try {\n        const features = new APIfeatures(Products.find(), req.query)\n        .filtering().sorting().paginating()\n\n        const products = await features.query\n        \n        res.json({\n            status: 'success',\n            result: products.length,\n            products\n        })\n    } catch (err) {\n        return res.status(500).json({err: err.message})\n    }\n}\n\nconst createProduct = async (req, res) => {\n    try {\n        const result = await auth(req, res)\n        if(result.role !== 'admin') return res.status(400).json({err: 'Authentication is not valid.'})\n\n        const {title, price, inStock, description, content, category, images} = req.body\n\n        if(!title || !price || !inStock || !description || !content || category === 'all' || images.length === 0)\n        return res.status(400).json({err: 'Please add all the fields.'})\n\n\n        const newProduct = new Products({\n            title: title.toLowerCase(), price, inStock, description, content, category, images\n        })\n\n        await newProduct.save()\n\n        res.json({msg: 'Success! Created a new product'})\n\n    } catch (err) {\n        return res.status(500).json({err: err.message})\n    }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}